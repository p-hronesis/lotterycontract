{"ast":null,"code":"var _jsxFileName = \"D:\\\\PROJECTS\\\\lottery_game\\\\lotterygame\\\\src\\\\App.js\",\n    _s = $RefreshSig$();\n\n// import logo from './logo.svg';\nimport './App.css';\nimport Menu from './components/Menu';\nimport { Header } from './components/Header';\nimport RecentWinners from './components/RecentWinners';\nimport Web3 from 'web3';\nimport abi from \"./abi/lottery.json\";\nimport { useEffect, useState } from 'react';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst INFURA_ENDPOINT = \"https://rinkeby.infura.io/v3/c95d9276d5e041acbe6411cdda48275e\";\n\nfunction App() {\n  _s();\n\n  const LotteryContractAddress = '0x65fd425aD3f20835662A9447677A7df40055EF68';\n  const [recentWinners, setrecentWinners] = useState([]);\n  const [isConnected, setisConnected] = useState(false);\n  const [accounts, setAccounts] = useState([]);\n  const [lotteryContract, setlotteryContract] = useState();\n  const [web3, setWeb3] = useState();\n  const [lotteryState, setlotteryState] = useState();\n  useEffect(() => {\n    const web3_temp = new Web3(INFURA_ENDPOINT);\n    setWeb3(web3_temp);\n    const lotteryContract = new web3_temp.eth.Contract(abi, LotteryContractAddress);\n    setlotteryContract(lotteryContract);\n    connectMetaMask();\n    detectMetaMaskAccountChange();\n    getRecentWinners(lotteryContract);\n    getLotteryState(lotteryContract);\n  }, []);\n\n  async function detectMetaMaskAccountChange() {\n    window.ethereum.on(\"accountsChanged\", async function () {\n      console.log('you changed the currently selected account'); // Time to reload your interface with accounts[0]!\n\n      const web3 = new Web3(Web3.givenProvider);\n      console.log('these are the new account');\n      console.log(await web3.eth.getAccounts());\n      setAccounts(await web3.eth.getAccounts()); // accounts = await web3.eth.getAccounts();\n\n      console.log(accounts);\n\n      if (!account) {\n        setisConnected(false);\n      }\n    });\n  }\n\n  function getRecentWinners(lotteryContract) {\n    lotteryContract.methods.lottery_count().call().then(lotteryCount => {\n      console.log('Lottery Count: ' + lotteryCount);\n      const recentWinnerstemp = [];\n      var countTemp = lotteryCount;\n\n      while (lotteryCount > 0) {\n        lotteryContract.methods.recentWinners(lotteryCount).call().then(response => {\n          // console.log(response)\n          recentWinnerstemp.push(response);\n          countTemp--;\n\n          if (countTemp == 0) {\n            // console.log(\"pppppppppp\")\n            console.log('Recent winners retrieved succesfully'); // setisConnected(connectMetaMask())\n\n            setrecentWinners(recentWinnerstemp); // console.log(recentWinners)\n          } else {\n            console.log(\"wwwwwwwwwwwwwww\");\n          }\n        }, error => {\n          console.log(error);\n        });\n        lotteryCount--;\n      }\n    }, error => {\n      console.log(error);\n      console.log(\"hhhhhhh\");\n    });\n  } // useEffect(() => {\n  //   if (Web3.givenProvider) {\n  //     const web3 = new Web3(Web3.givenProvider);\n  //     web3.eth.getAccounts().then(setAccounts);\n  //     setisConnected(true)\n  //   }\n  // }, [])\n\n\n  function getLotteryState(lotteryContract) {\n    lotteryContract.methods.lottery_state().call().then(response => {\n      console.log('attempting to get lottery contract state');\n      console.log(response);\n      console.log('attempting to get lottery contract state');\n\n      switch (response) {\n        case '0':\n          setlotteryState(\"Ended/Not Started\");\n          break;\n\n        case '1':\n          setlotteryState(\"Ongoing\");\n          break;\n\n        case '2':\n          setlotteryState(\"Calculating winner, please wait\");\n          break;\n\n        default:\n          setlotteryState(\"Unknown!\");\n          break;\n      }\n    }, error => {\n      console.log(error);\n    });\n  }\n\n  function endLottery() {\n    const web3 = new Web3(INFURA_ENDPOINT);\n    const lotteryContract = new web3.eth.Contract(abi, LotteryContractAddress);\n    const lotteryOwnerAddress = \"0x281B3B65AE71fc4EBBa61325a6bC2974B80F04c2\";\n    var lotteryContractOwner = web3.eth.accounts.privateKeyToAccount('0x65cde2fe2e5f7c84d33f6e1b25585ff2469b5704d43e1c18a72b5b6978aef57a');\n    web3.eth.getTransactionCount(lotteryOwnerAddress, async (err, txCount) => {\n      // Build the transaction\n      console.log(txCount);\n      console.log(lotteryContractOwner.privateKey); // console.log(lotteryContractOwner)\n\n      const txObject = {\n        nonce: txCount,\n        to: LotteryContractAddress,\n        // value: web3.utils.toHex(web3.utils.toWei('20', 'ether')),\n        gasLimit: 300000,\n        gasPrice: web3.utils.toHex(web3.utils.toWei('10', 'gwei')),\n        chainId: 4,\n        data: lotteryContract.methods.endLottery().encodeABI()\n      };\n      const signedTx = await web3.eth.accounts.signTransaction(txObject, lotteryContractOwner.privateKey);\n      console.log('attempting to send signed transaction');\n      web3.eth.sendSignedTransaction(signedTx.rawTransaction, function (error, hash) {\n        if (!error) {\n          console.log(\"🎉 The hash of your transaction is: \", hash, \"\\n Check Infura's Mempool to view the status of your transaction!\");\n        } else {\n          console.log(\"❗Something went wrong while submitting your transaction:\", error);\n        }\n      }).then(response => {\n        setlotteryState(\"Ended/Not Started\");\n        console.log('this is the transaction receipt');\n        console.log(response);\n      }, error => {\n        console.log('this is the transaction error receipt');\n        console.log(error);\n      });\n    });\n    console.log('Attempting to end lottery');\n  }\n\n  function startLottery() {\n    const web3 = new Web3(INFURA_ENDPOINT);\n    const lotteryContract = new web3.eth.Contract(abi, LotteryContractAddress);\n    const lotteryOwnerAddress = \"0x281B3B65AE71fc4EBBa61325a6bC2974B80F04c2\";\n    var lotteryContractOwner = web3.eth.accounts.privateKeyToAccount('0x65cde2fe2e5f7c84d33f6e1b25585ff2469b5704d43e1c18a72b5b6978aef57a');\n    web3.eth.getTransactionCount(lotteryOwnerAddress, async (err, txCount) => {\n      // Build the transaction\n      console.log(txCount);\n      console.log(lotteryContractOwner.privateKey); // console.log(lotteryContractOwner)\n\n      const txObject = {\n        nonce: txCount,\n        to: LotteryContractAddress,\n        // value: web3.utils.toHex(web3.utils.toWei('20', 'ether')),\n        gasLimit: 300000,\n        gasPrice: web3.utils.toHex(web3.utils.toWei('10', 'gwei')),\n        chainId: 4,\n        data: lotteryContract.methods.startLottery().encodeABI()\n      };\n      const signedTx = await web3.eth.accounts.signTransaction(txObject, lotteryContractOwner.privateKey);\n      console.log('attempting to send signed transaction');\n      web3.eth.sendSignedTransaction(signedTx.rawTransaction, function (error, hash) {\n        if (!error) {\n          console.log(\"🎉 The hash of your transaction is: \", hash, \"\\n Check Infura's Mempool to view the status of your transaction!\");\n        } else {\n          console.log(\"❗Something went wrong while submitting your transaction:\", error);\n        }\n      }).then(response => {\n        setlotteryState(\"Ongoing\");\n        console.log('this is the transaction receipt');\n        console.log(response);\n      }, error => {\n        console.log('this is the transaction error receipt');\n        console.log(error);\n      });\n    });\n    console.log('Attempting to start lottery');\n  }\n\n  function enterLottery() {\n    console.log('attempting to enter lottery'); // console.log(isConnected)\n\n    const web3 = new Web3(Web3.givenProvider);\n    const lotteryContract = new web3.eth.Contract(abi, LotteryContractAddress);\n    lotteryContract.methods.entranceFeeInWei().call().then(response => {\n      // console.log(response)\n      console.log(accounts);\n      lotteryContract.methods.enter().send({\n        from: accounts[0],\n        value: response * 1.05\n      }).then(response => {\n        console.log('Entered lottery succesfully'); // console.log(response)\n      }, errorii => {\n        console.log('An error occured while attempting to enter lottery');\n        console.log(errorii);\n      });\n    }, error => {\n      console.log('error retrieving the entrance fee in wei' + error);\n    });\n  }\n\n  const connectMetaMask = async () => {\n    console.log(\"attempting to connect metamask\");\n\n    if (window.ethereum) {\n      try {\n        Web3.givenProvider.send('eth_requestAccounts').then(response => {\n          setAccounts(response.result);\n          console.log('There was no error connecting to metamask');\n          setisConnected(true);\n          return true;\n        });\n      } catch (error) {\n        console.log('There was an error connecting to metamask');\n        return false;\n      }\n    }\n  };\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    children: [/*#__PURE__*/_jsxDEV(Menu, {\n      id: \"Home\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 250,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(Header, {\n      account: accounts[0],\n      endLottery: endLottery,\n      startLottery: startLottery,\n      enterLottery: enterLottery,\n      connectMetaMask: connectMetaMask,\n      isConnected: isConnected,\n      lotteryState: lotteryState\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 251,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"table\", {\n      children: /*#__PURE__*/_jsxDEV(RecentWinners, {\n        recentWinners: recentWinners\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 253,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 252,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 249,\n    columnNumber: 5\n  }, this);\n}\n\n_s(App, \"yV8gWzEWmye5C2mrSKouk4eEYAo=\");\n\n_c = App;\nexport default App;\n\nvar _c;\n\n$RefreshReg$(_c, \"App\");","map":{"version":3,"sources":["D:/PROJECTS/lottery_game/lotterygame/src/App.js"],"names":["Menu","Header","RecentWinners","Web3","abi","useEffect","useState","INFURA_ENDPOINT","App","LotteryContractAddress","recentWinners","setrecentWinners","isConnected","setisConnected","accounts","setAccounts","lotteryContract","setlotteryContract","web3","setWeb3","lotteryState","setlotteryState","web3_temp","eth","Contract","connectMetaMask","detectMetaMaskAccountChange","getRecentWinners","getLotteryState","window","ethereum","on","console","log","givenProvider","getAccounts","account","methods","lottery_count","call","then","lotteryCount","recentWinnerstemp","countTemp","response","push","error","lottery_state","endLottery","lotteryOwnerAddress","lotteryContractOwner","privateKeyToAccount","getTransactionCount","err","txCount","privateKey","txObject","nonce","to","gasLimit","gasPrice","utils","toHex","toWei","chainId","data","encodeABI","signedTx","signTransaction","sendSignedTransaction","rawTransaction","hash","startLottery","enterLottery","entranceFeeInWei","enter","send","from","value","errorii","result"],"mappings":"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","sourcesContent":["// import logo from './logo.svg';\nimport './App.css';\nimport Menu from './components/Menu';\nimport { Header } from './components/Header';\nimport RecentWinners from './components/RecentWinners';\nimport Web3 from 'web3';\nimport abi from \"./abi/lottery.json\"\nimport { useEffect, useState } from 'react';\nconst INFURA_ENDPOINT = \"https://rinkeby.infura.io/v3/c95d9276d5e041acbe6411cdda48275e\"\nfunction App() {\n\n  const LotteryContractAddress = '0x65fd425aD3f20835662A9447677A7df40055EF68'\n  const [recentWinners, setrecentWinners] = useState([]);\n  const [isConnected, setisConnected] = useState(false);\n  const [accounts, setAccounts] = useState([]);\n  const [lotteryContract, setlotteryContract] = useState();\n  const [web3, setWeb3] = useState()\n  const [lotteryState, setlotteryState] = useState()\n\n  useEffect(() => {\n    const web3_temp = new Web3(INFURA_ENDPOINT)\n    setWeb3(web3_temp)\n    const lotteryContract = new web3_temp.eth.Contract(abi, LotteryContractAddress)\n    setlotteryContract(lotteryContract)\n    connectMetaMask()\n    detectMetaMaskAccountChange();\n    getRecentWinners(lotteryContract)\n    getLotteryState(lotteryContract)\n  }, []);\n\n  async function detectMetaMaskAccountChange() {\n    window.ethereum.on(\"accountsChanged\", async function () {\n      console.log('you changed the currently selected account')\n      // Time to reload your interface with accounts[0]!\n      const web3 = new Web3(Web3.givenProvider);\n      console.log('these are the new account')\n      console.log(await web3.eth.getAccounts());\n      setAccounts(await web3.eth.getAccounts())\n      // accounts = await web3.eth.getAccounts();\n      console.log(accounts);\n      if (!account) {\n        setisConnected(false)\n      }\n    });\n  }\n\n  function getRecentWinners(lotteryContract) {\n    lotteryContract.methods.lottery_count().call().then((lotteryCount) => {\n      console.log('Lottery Count: ' + lotteryCount)\n      const recentWinnerstemp = []\n      var countTemp = lotteryCount\n      while (lotteryCount > 0) {\n        lotteryContract.methods.recentWinners(lotteryCount).call().then((response) => {\n          // console.log(response)\n          recentWinnerstemp.push(response)\n          countTemp--\n          if (countTemp == 0) {\n            // console.log(\"pppppppppp\")\n            console.log('Recent winners retrieved succesfully')\n            // setisConnected(connectMetaMask())\n            setrecentWinners(recentWinnerstemp)\n            // console.log(recentWinners)\n\n          } else {\n            console.log(\"wwwwwwwwwwwwwww\")\n\n          }\n        }, (error) => {\n          console.log(error)\n        })\n\n        lotteryCount--\n      }\n\n    }, (error) => {\n      console.log(error)\n      console.log(\"hhhhhhh\")\n    })\n  }\n\n  // useEffect(() => {\n  //   if (Web3.givenProvider) {\n  //     const web3 = new Web3(Web3.givenProvider);\n  //     web3.eth.getAccounts().then(setAccounts);\n  //     setisConnected(true)\n  //   }\n  // }, [])\n  function getLotteryState(lotteryContract) {\n    lotteryContract.methods.lottery_state().call().then((response) => {\n      console.log('attempting to get lottery contract state')\n      console.log(response)\n      console.log('attempting to get lottery contract state')\n\n      switch (response) {\n        case '0':\n          setlotteryState(\"Ended/Not Started\")\n          break;\n        case '1':\n          setlotteryState(\"Ongoing\")\n          break;\n        case '2':\n          setlotteryState(\"Calculating winner, please wait\")\n          break;\n        default:\n          setlotteryState(\"Unknown!\")\n          break;\n      }\n    }, (error) => {\n      console.log(error)\n    })\n  }\n  function endLottery() {\n    const web3 = new Web3(INFURA_ENDPOINT);\n    const lotteryContract = new web3.eth.Contract(abi, LotteryContractAddress);\n    const lotteryOwnerAddress = \"0x281B3B65AE71fc4EBBa61325a6bC2974B80F04c2\"\n    var lotteryContractOwner = web3.eth.accounts.privateKeyToAccount('0x65cde2fe2e5f7c84d33f6e1b25585ff2469b5704d43e1c18a72b5b6978aef57a');\n\n    web3.eth.getTransactionCount(lotteryOwnerAddress, async (err, txCount) => {\n      // Build the transaction\n      console.log(txCount)\n      console.log(lotteryContractOwner.privateKey)\n      // console.log(lotteryContractOwner)\n      const txObject = {\n        nonce: txCount,\n        to: LotteryContractAddress,\n        // value: web3.utils.toHex(web3.utils.toWei('20', 'ether')),\n        gasLimit: 300000,\n        gasPrice: web3.utils.toHex(web3.utils.toWei('10', 'gwei')),\n        chainId: 4,\n        data: lotteryContract.methods.endLottery().encodeABI()\n      }\n\n      const signedTx = await web3.eth.accounts.signTransaction(txObject, lotteryContractOwner.privateKey);\n\n      console.log('attempting to send signed transaction')\n      web3.eth.sendSignedTransaction(signedTx.rawTransaction, function (error, hash) {\n        if (!error) {\n          console.log(\"🎉 The hash of your transaction is: \", hash, \"\\n Check Infura's Mempool to view the status of your transaction!\");\n\n        } else {\n          console.log(\"❗Something went wrong while submitting your transaction:\", error)\n        }\n      }).then((response) => {\n        setlotteryState(\"Ended/Not Started\")\n        console.log('this is the transaction receipt')\n        console.log(response)\n      },\n        (error) => {\n          console.log('this is the transaction error receipt')\n          console.log(error)\n        }\n      )\n    })\n\n    console.log('Attempting to end lottery')\n  }\n\n  function startLottery() {\n\n    const web3 = new Web3(INFURA_ENDPOINT);\n    const lotteryContract = new web3.eth.Contract(abi, LotteryContractAddress);\n    const lotteryOwnerAddress = \"0x281B3B65AE71fc4EBBa61325a6bC2974B80F04c2\"\n    var lotteryContractOwner = web3.eth.accounts.privateKeyToAccount('0x65cde2fe2e5f7c84d33f6e1b25585ff2469b5704d43e1c18a72b5b6978aef57a');\n\n    web3.eth.getTransactionCount(lotteryOwnerAddress, async (err, txCount) => {\n      // Build the transaction\n      console.log(txCount)\n      console.log(lotteryContractOwner.privateKey)\n      // console.log(lotteryContractOwner)\n      const txObject = {\n        nonce: txCount,\n        to: LotteryContractAddress,\n        // value: web3.utils.toHex(web3.utils.toWei('20', 'ether')),\n        gasLimit: 300000,\n        gasPrice: web3.utils.toHex(web3.utils.toWei('10', 'gwei')),\n        chainId: 4,\n        data: lotteryContract.methods.startLottery().encodeABI()\n      }\n\n      const signedTx = await web3.eth.accounts.signTransaction(txObject, lotteryContractOwner.privateKey);\n\n      console.log('attempting to send signed transaction')\n      web3.eth.sendSignedTransaction(signedTx.rawTransaction, function (error, hash) {\n        if (!error) {\n          console.log(\"🎉 The hash of your transaction is: \", hash, \"\\n Check Infura's Mempool to view the status of your transaction!\");\n\n        } else {\n          console.log(\"❗Something went wrong while submitting your transaction:\", error)\n        }\n      }).then((response) => {\n        setlotteryState(\"Ongoing\")\n        console.log('this is the transaction receipt')\n        console.log(response)\n      },\n        (error) => {\n          console.log('this is the transaction error receipt')\n          console.log(error)\n        }\n      )\n    })\n    console.log('Attempting to start lottery')\n\n  }\n\n  function enterLottery() {\n    console.log('attempting to enter lottery')\n    // console.log(isConnected)\n    const web3 = new Web3(Web3.givenProvider);\n    const lotteryContract = new web3.eth.Contract(abi, LotteryContractAddress);\n    lotteryContract.methods.entranceFeeInWei().call().then((response) => {\n      // console.log(response)\n      console.log(accounts)\n      lotteryContract.methods.enter().send({ from: accounts[0], value: response * 1.05 }).then(\n        (response) => {\n          console.log('Entered lottery succesfully')\n          // console.log(response)\n        },\n        (errorii) => {\n          console.log('An error occured while attempting to enter lottery')\n          console.log(errorii)\n        }\n      )\n    },\n      (error) => {\n        console.log('error retrieving the entrance fee in wei' + error)\n      })\n\n  }\n\n  const connectMetaMask = async () => {\n    console.log(\"attempting to connect metamask\")\n    if (window.ethereum) {\n      try {\n        Web3.givenProvider.send('eth_requestAccounts')\n          .then((response) => {\n            setAccounts(response.result)\n            console.log('There was no error connecting to metamask')\n            setisConnected(true)\n            return true;\n          });\n      } catch (error) {\n        console.log('There was an error connecting to metamask')\n        return false;\n      }\n    }\n  }\n\n  return (\n    <div>\n      <Menu id={\"Home\"} />\n      <Header account={accounts[0]} endLottery={endLottery} startLottery={startLottery} enterLottery={enterLottery} connectMetaMask={connectMetaMask} isConnected={isConnected} lotteryState={lotteryState} />\n      <table>\n        <RecentWinners recentWinners={recentWinners} />\n      </table>\n\n      {/* <div className=\"App\">\n        <header className=\"App-header\">\n          <Menu />\n        </header>\n      </div> */}\n    </div>\n  );\n}\n\nexport default App;\n"]},"metadata":{},"sourceType":"module"}